# Optimized VictoriaMetrics k8s stack for single-node A1 (ARM64)
fullnameOverride: vm

# Enable Alertmanager with custom config secret
alertmanager:
  enabled: true
  spec:
    configSecret: alertmanager-config
    resources:
      limits:
        cpu: 200m
        memory: 256Mi

# vmalert uses alertmanager for notifying
vmalert:
  enabled: true
  spec:
    resources:
      limits:
        cpu: 200m
        memory: 256Mi
    # No longer blackhole, it will now talk to alertmanager

# Grafana is included in the stack, but we can also use it separately.
# For now, let's keep it in the stack for easier integration.
grafana:
  enabled: true
  ingress:
    enabled: true
    ingressClassName: nginx
    annotations:
      cert-manager.io/cluster-issuer: letsencrypt-prod
      nginx.ingress.kubernetes.io/backend-protocol: "HTTP"
    hosts:
      - grafana.pseudolab-devfactory.com
    tls:
      - secretName: grafana-tls
        hosts:
          - grafana.pseudolab-devfactory.com
  admin:
    existingSecret: grafana-admin-creds
    userKey: admin-user
    passwordKey: admin-password

# VictoriaMetrics Single node (cheaper than cluster version)
vmsingle:
  enabled: true
  spec:
    replicaCount: 1
    resources:
      limits:
        cpu: 500m
        memory: 1024Mi
      requests:
        cpu: 100m
        memory: 512Mi
    retentionPeriod: "14d"

# Scrape configurations
vmagent:
  enabled: true
  spec:
    resources:
      limits:
        cpu: 200m
        memory: 256Mi
    remoteWrite:
      - url: "http://vmsingle-vm.monitoring.svc:8429/api/v1/write"

# Component configurations
kubeStateMetrics:
  enabled: true

prometheus-node-exporter:
  enabled: true
  resources:
    limits:
      cpu: 100m
      memory: 128Mi

# k3s specific: These components are internal or bind to localhost, causing 'Down' alerts.
kubeScheduler:
  enabled: false
kubeControllerManager:
  enabled: false
kubeProxy:
  enabled: false
kubeEtcd:
  enabled: false

kubelet:
  enabled: true
  serviceMonitor:
    https: true # k3s kubelet uses https on 10250
